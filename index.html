
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>My Tetris</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
            crossorigin="anonymous"></script>
    <link href="style.css" rel="stylesheet">
    <script src="my_tetris.js"></script>
</head>
<br>
<body>
<div class="container px4 border">
    <div class="row">
        <div class="col border" id="leftCol">
            <div class="row border" id="logoArea">
                <a href="#">
                    <img class="img-fluid mx-auto d-block" style="max-width: 50%; height: auto;"
                         src="resources/static/images/The_Tetris_Company_logo_2019.png" alt="">
                </a>
            </div>
            <br>
            <div class="row border" id="buttonsArea">
                <button type="button" class="btn btn-lg btn-success mx-auto d-block" id="playButton"
                        data-bs-toggle="button"
                        autocomplete="off">
                    Start
                </button>
            </div>
            <br>
            <div class="row border">
                <div class="col" id="instructions">
                    instructions
                </div>
            </div>
        </div>
        <div class="col-lg border" id="middleCol">
            <div class="row border gameArea">
                <!--                <canvas id="gameCanvas" width="200" height="440">-->
                <canvas id="gameCanvas">
                </canvas>
            </div>
        </div>
        <div class="col border" id="rightCol">
            <div class="row-sm border">
                hold
                <canvas id="holdCanvas" width="20" height="44">
                </canvas>
            </div>
            <br>
            <div class="row-sm border">
                next
                <canvas id="nextCanvas" width="20" height="44">
                </canvas>
            </div>
            <br>
            <div class="row border" id="scoreAndLevelArea">
                <div class="col" id="levelArea">
                    level
                </div>
                <div class="col" id="scoreArea">
                    score
                </div>
            </div>
        </div>
    </div>
    <br>
    <br>
    <div class="row border">
        <div class="col" id="devCol">
            <div>
                <button type="button" class="btn btn-lg btn-secondary" id="switch" data-bs-toggle="button"
                        autocomplete="off">
                    Tetromino
                </button>
            </div>
            <div>
                <button type="button" class="btn btn-lg btn-secondary" id="field" data-bs-toggle="button"
                        autocomplete="off">
                    Field
                </button>
            </div>
        </div>
    </div>
</div>
<script>
    let blockSize = initCanvasReturnCellSize();
    const playButton = document.getElementById("playButton");
    const gameCanvas = document.getElementById("gameCanvas").getContext("2d");
    const holdCanvas = document.getElementById("holdCanvas").getContext("2d");
    const nextCanvas = document.getElementById("nextCanvas").getContext("2d");
    let game = new Game(gameCanvas, nextCanvas, holdCanvas, blockSize);
    let key = null;
    let gameActive = false;
    let intervalId;

    let speed = 1000;
    let levelUp = false;

    function changePlayButton() {
        if (gameActive) {
            playButton.innerText = "Pause";
            playButton.classList.remove("btn-success")
            playButton.classList.add("btn-danger")
        } else {
            playButton.innerText = "Continue";
            playButton.classList.remove("btn-danger")
            playButton.classList.add("btn-success")
        }
    }

    function initCanvasReturnCellSize() {
        let sizeOfIndividualBlocks = Math.round(((window.innerWidth) / 2) / 200) * 20;
        let gameWidth = (sizeOfIndividualBlocks * 10).toString();
        let gameHeight = (sizeOfIndividualBlocks * 22).toString();
        let sideWidthHeight = (sizeOfIndividualBlocks * 2).toString();
        document.getElementById("gameCanvas").setAttribute("width", gameWidth);
        document.getElementById("gameCanvas").setAttribute("height", gameHeight);
        document.getElementById("nextCanvas").setAttribute("width", sideWidthHeight);
        document.getElementById("nextCanvas").setAttribute("height", sideWidthHeight);
        document.getElementById("holdCanvas").setAttribute("width", sideWidthHeight);
        document.getElementById("holdCanvas").setAttribute("height", sideWidthHeight);
        return sizeOfIndividualBlocks;
    }

    window.addEventListener('keydown', function (event) {
        if (event.defaultPrevented) {
            return;
        }
        key = event.code;
        if (gameActive) {
            if (key === "Escape" || key === "F1") {
                gameActive = false;
                clearInterval(intervalId)
                changePlayButton();
            } else {
                game.play(key);
            }
        }
        key = null;
        event.preventDefault();
    }, true);

    function runGame(intervalSpeed) {
        clearInterval(intervalId);
        intervalId = setInterval(function () {
            document.getElementById("levelArea").innerText = "Level\n" + (game.level).toString();
            document.getElementById("scoreArea").innerText = "Score\n" + (game.points).toString();
            levelUp = game.play("auto")
            if (levelUp) {
                speed = 1000 * Math.pow((0.8 - (game.level - 1) * 0.007), game.level - 1);
                runGame(speed);
            }
        }, intervalSpeed)

    }

    playButton.addEventListener("click", function () {
        gameActive = !gameActive;
        clearInterval(intervalId);
        if (gameActive) {
            changePlayButton();
            runGame(speed);
        } else {
            changePlayButton();
        }
    });

    // debugging: switch tetromino
    document.getElementById("switch").addEventListener("click", function () {
        game.field.tetromino = new Tetromino(gameCanvas);
    });

    // debugging: changes field to one with rows that are almost complete
    document.getElementById("field").addEventListener("click", function () {
        game.field.gameArea = [
            [
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, '']
            ],
            [
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, '']
            ],
            [
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, '']
            ],
            [
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, '']
            ],
            [
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, '']
            ],
            [
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, '']
            ],
            [
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, '']
            ],
            [
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, '']
            ],
            [
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, '']
            ],
            [
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, '']
            ],
            [
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, '']
            ],
            [
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, '']
            ],
            [
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, '']
            ],
            [
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, '']
            ],
            [
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, '']
            ],
            [
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, '']
            ],
            [
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, '']
            ],
            [
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, '']
            ],
            [
                [1, 'cyan'], [1, 'cyan'],
                [1, 'cyan'], [1, 'cyan'],
                [1, 'cyan'], [0, ''],
                [1, 'cyan'], [1, 'cyan'],
                [1, 'cyan'], [1, 'cyan']
            ],
            [
                [1, 'cyan'], [1, 'cyan'],
                [1, 'cyan'], [1, 'cyan'],
                [1, 'cyan'], [0, ''],
                [1, 'cyan'], [1, 'cyan'],
                [1, 'cyan'], [1, 'cyan']
            ],
            [
                [1, 'cyan'], [1, 'cyan'],
                [1, 'cyan'], [1, 'cyan'],
                [1, 'cyan'], [0, ''],
                [1, 'cyan'], [1, 'cyan'],
                [1, 'cyan'], [1, 'cyan']
            ],
            [
                [1, 'cyan'], [1, 'cyan'],
                [1, 'cyan'], [1, 'cyan'],
                [1, 'cyan'], [0, ''],
                [1, 'cyan'], [1, 'cyan'],
                [1, 'cyan'], [1, 'cyan']
            ]
        ];
    });
</script>
</body>
</html>

