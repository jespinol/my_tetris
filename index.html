<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>My Tetris</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
            crossorigin="anonymous"></script>
    <link href="style.css" rel="stylesheet">
    <script src="my_tetris.js"></script>
</head>
<br>
<body>
<div class="container px4">
    <div class="row g-6">
        <div class="col-4" id="leftCol">
            <div class="row g-6" id="logoArea">
                <a href="#">
                    <img class="img-fluid mx-auto d-block" style="max-width: 90%; height: auto;"
                         src="resources/static/images/The_Tetris_Company_logo_2019.png" alt="">
                </a>
            </div>
            <div class="row g-6" id="buttonsArea">
                <button type="button" class="btn btn-lg btn-success mx-auto d-block" id="playButton"
                        data-bs-toggle="button"
                        autocomplete="off">
                    Start
                </button>
            </div>
            <div class="row g-6" id="scoreAndLevelArea">
                <div class="col-sm">
                    level
                </div>
                <div class="col-sm">
                    score
                </div>
            </div>
            <div class="row g-6" id="holdArea">
                hold
            </div>
        </div>
        <div class="col-8" id="rightCol">
            <div class="border">
                <canvas id="canvas" width="200" height="440">
                </canvas>
            </div>
        </div>
    </div>
    <br>
    <div class="row">
        <div class="col" id="bottomCol">
            instructions
        </div>
    </div>
    <br>
    <div class="row">
        <div class="col" id="devCol">
            <div>
                <button type="button" class="btn btn-lg btn-secondary" id="switch" data-bs-toggle="button"
                        autocomplete="off">
                    Tetromino
                </button>
            </div>
            <div>
                <button type="button" class="btn btn-lg btn-secondary" id="field" data-bs-toggle="button"
                        autocomplete="off">
                    Field
                </button>
            </div>
        </div>
    </div>
</div>
<script>
    const button = document.getElementById("playButton");
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");
    let game = new Game(ctx);
    let key = null;
    let gameActive = false;
    let intervalId;

    let speed = 1000;
    let levelUp = false;

    function changePlayButton() {
        if (gameActive) {
            button.innerText = "Pause";
            button.classList.remove("btn-success")
            button.classList.add("btn-danger")
        } else {
            button.innerText = "Continue";
            button.classList.remove("btn-danger")
            button.classList.add("btn-success")
        }
    }

    window.addEventListener('keydown', function (event) {
        if (event.defaultPrevented) {
            return;
        }
        key = event.code;
        if (gameActive) {
            if (key === "Escape" || key === "F1") {
                gameActive = false;
                clearInterval(intervalId)
                changePlayButton();
            } else {
                game.play(key);
            }
        }
        key = null;
        event.preventDefault();
    }, true);

    function runGame(intervalSpeed) {
        clearInterval(intervalId);
        intervalId = setInterval(function () {
            levelUp = game.play("auto")
            if (levelUp) {
                speed = 1000 * Math.pow((0.8 - (game.level - 1) * 0.007), game.level - 1);
                runGame(speed);
            }
        }, intervalSpeed)

    }

    button.addEventListener("click", function () {
        gameActive = !gameActive;
        clearInterval(intervalId);
        if (gameActive) {
            changePlayButton();
            runGame(speed);
        } else {
            changePlayButton();
        }
    });

    // debugging: switch tetromino
    document.getElementById("switch").addEventListener("click", function () {
        game.field.tetromino = new Tetromino(ctx);
    });

    // debugging: changes field to one with rows that are almost complete
    document.getElementById("field").addEventListener("click", function () {
        let almostFull = [
            [
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, '']
            ],
            [
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, '']
            ],
            [
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, '']
            ],
            [
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, '']
            ],
            [
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, '']
            ],
            [
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, '']
            ],
            [
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, '']
            ],
            [
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, '']
            ],
            [
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, '']
            ],
            [
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, '']
            ],
            [
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, '']
            ],
            [
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, '']
            ],
            [
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, '']
            ],
            [
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, '']
            ],
            [
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, '']
            ],
            [
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, '']
            ],
            [
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, '']
            ],
            [
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, ''],
                [0, ''], [0, '']
            ],
            [
                [1, 'cyan'], [1, 'cyan'],
                [1, 'cyan'], [1, 'cyan'],
                [1, 'cyan'], [0, ''],
                [1, 'cyan'], [1, 'cyan'],
                [1, 'cyan'], [1, 'cyan']
            ],
            [
                [1, 'cyan'], [1, 'cyan'],
                [1, 'cyan'], [1, 'cyan'],
                [1, 'cyan'], [0, ''],
                [1, 'cyan'], [1, 'cyan'],
                [1, 'cyan'], [1, 'cyan']
            ],
            [
                [1, 'cyan'], [1, 'cyan'],
                [1, 'cyan'], [1, 'cyan'],
                [1, 'cyan'], [0, ''],
                [1, 'cyan'], [1, 'cyan'],
                [1, 'cyan'], [1, 'cyan']
            ],
            [
                [1, 'cyan'], [1, 'cyan'],
                [1, 'cyan'], [1, 'cyan'],
                [1, 'cyan'], [0, ''],
                [1, 'cyan'], [1, 'cyan'],
                [1, 'cyan'], [1, 'cyan']
            ]
        ];
        // let empty = [
        //     [
        //         [0, ''], [0, ''],
        //         [0, ''], [0, ''],
        //         [0, ''], [0, ''],
        //         [0, ''], [0, ''],
        //         [0, ''], [0, '']
        //     ],
        //     [
        //         [0, ''], [0, ''],
        //         [0, ''], [0, ''],
        //         [0, ''], [0, ''],
        //         [0, ''], [0, ''],
        //         [0, ''], [0, '']
        //     ],
        //     [
        //         [0, ''], [0, ''],
        //         [0, ''], [0, ''],
        //         [0, ''], [0, ''],
        //         [0, ''], [0, ''],
        //         [0, ''], [0, '']
        //     ],
        //     [
        //         [0, ''], [0, ''],
        //         [0, ''], [0, ''],
        //         [0, ''], [0, ''],
        //         [0, ''], [0, ''],
        //         [0, ''], [0, '']
        //     ],
        //     [
        //         [0, ''], [0, ''],
        //         [0, ''], [0, ''],
        //         [0, ''], [0, ''],
        //         [0, ''], [0, ''],
        //         [0, ''], [0, '']
        //     ],
        //     [
        //         [0, ''], [0, ''],
        //         [0, ''], [0, ''],
        //         [0, ''], [0, ''],
        //         [0, ''], [0, ''],
        //         [0, ''], [0, '']
        //     ],
        //     [
        //         [0, ''], [0, ''],
        //         [0, ''], [0, ''],
        //         [0, ''], [0, ''],
        //         [0, ''], [0, ''],
        //         [0, ''], [0, '']
        //     ],
        //     [
        //         [0, ''], [0, ''],
        //         [0, ''], [0, ''],
        //         [0, ''], [0, ''],
        //         [0, ''], [0, ''],
        //         [0, ''], [0, '']
        //     ],
        //     [
        //         [0, ''], [0, ''],
        //         [0, ''], [0, ''],
        //         [0, ''], [0, ''],
        //         [0, ''], [0, ''],
        //         [0, ''], [0, '']
        //     ],
        //     [
        //         [0, ''], [0, ''],
        //         [0, ''], [0, ''],
        //         [0, ''], [0, ''],
        //         [0, ''], [0, ''],
        //         [0, ''], [0, '']
        //     ],
        //     [
        //         [0, ''], [0, ''],
        //         [0, ''], [0, ''],
        //         [0, ''], [0, ''],
        //         [0, ''], [0, ''],
        //         [0, ''], [0, '']
        //     ],
        //     [
        //         [0, ''], [0, ''],
        //         [0, ''], [0, ''],
        //         [0, ''], [0, ''],
        //         [0, ''], [0, ''],
        //         [0, ''], [0, '']
        //     ],
        //     [
        //         [0, ''], [0, ''],
        //         [0, ''], [0, ''],
        //         [0, ''], [0, ''],
        //         [0, ''], [0, ''],
        //         [0, ''], [0, '']
        //     ],
        //     [
        //         [0, ''], [0, ''],
        //         [0, ''], [0, ''],
        //         [0, ''], [0, ''],
        //         [0, ''], [0, ''],
        //         [0, ''], [0, '']
        //     ],
        //     [
        //         [0, ''], [0, ''],
        //         [0, ''], [0, ''],
        //         [0, ''], [0, ''],
        //         [0, ''], [0, ''],
        //         [0, ''], [0, '']
        //     ],
        //     [
        //         [0, ''], [0, ''],
        //         [0, ''], [0, ''],
        //         [0, ''], [0, ''],
        //         [0, ''], [0, ''],
        //         [0, ''], [0, '']
        //     ],
        //     [
        //         [0, ''], [0, ''],
        //         [0, ''], [0, ''],
        //         [0, ''], [0, ''],
        //         [0, ''], [0, ''],
        //         [0, ''], [0, '']
        //     ],
        //     [
        //         [0, ''], [0, ''],
        //         [0, ''], [0, ''],
        //         [0, ''], [0, ''],
        //         [0, ''], [0, ''],
        //         [0, ''], [0, '']
        //     ],
        //     [
        //         [0, ''], [0, ''],
        //         [0, ''], [0, ''],
        //         [0, ''], [0, ''],
        //         [0, ''], [0, ''],
        //         [0, ''], [0, '']
        //     ],
        //     [
        //         [0, ''], [0, ''],
        //         [0, ''], [0, ''],
        //         [0, ''], [0, ''],
        //         [0, ''], [0, ''],
        //         [0, ''], [0, '']
        //     ],
        //     [
        //         [0, ''], [0, ''],
        //         [0, ''], [0, ''],
        //         [0, ''], [0, ''],
        //         [0, ''], [0, ''],
        //         [0, ''], [0, '']
        //     ],
        //     [
        //         [0, ''], [0, ''],
        //         [0, ''], [0, ''],
        //         [0, ''], [0, ''],
        //         [0, ''], [0, ''],
        //         [0, ''], [0, '']
        //     ]
        // ];
        game.field.gameArea = almostFull;
    });
</script>
</body>
</html>